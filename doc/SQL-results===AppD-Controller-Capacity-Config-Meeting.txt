
mysql> select from_unixtime(ts_min*60), count(distinct node_id), count(*) from metricdata_min where ts_min > (select max(ts_min) - 10 from metricdata_min) group by 1 order by 1;
+--------------------------+-------------------------+----------+
| from_unixtime(ts_min*60) | count(distinct node_id) | count(*) |
+--------------------------+-------------------------+----------+
| 2014-08-29 14:49:00      |                      41 |     8608 |
| 2014-08-29 14:50:00      |                      41 |     8260 |
| 2014-08-29 14:51:00      |                      41 |     8260 |
| 2014-08-29 14:52:00      |                      41 |     7673 |
| 2014-08-29 14:53:00      |                      41 |     8021 |
| 2014-08-29 14:54:00      |                      41 |     8021 |
| 2014-08-29 14:55:00      |                      41 |     8021 |
| 2014-08-29 14:56:00      |                      41 |     8021 |
| 2014-08-29 14:57:00      |                      41 |     8686 |
| 2014-08-29 14:58:00      |                       4 |      396 |
+--------------------------+-------------------------+----------+
10 rows in set (0.21 sec)

mysql>
mysql> select count(*) from metric;

+----------+
| count(*) |
+----------+
|     9772 |
+----------+
1 row in set (0.03 sec)

mysql>
mysql> select * from agent;
+------------+----+---------+---------------+-------------------------------------------------------------------------------------------------------+---------------+---------------+---------------+---------------------+--------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------+-------------------+----------------------------+
| account_id | id | version | type          | agent_version                                                                                         | major_release | minor_release | point_release | agent_point_release | agent_runtime                                                                                          | install_dir                                                                          | install_timestamp | last_agent_start_timestamp |
+------------+----+---------+---------------+-------------------------------------------------------------------------------------------------------+---------------+---------------+---------------+---------------------+--------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------+-------------------+----------------------------+
|          1 |  1 |      10 | APP_AGENT     | Server Agent v3.8.4.0 GA #2014-06-30_13-28-42 r5dc2d8d219673e698b0b455657ac469bc8b59337 4-3.8.4.next  |             3 |             8 |             4 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_45    | /apps/lriservers/appDynamics/Controller/appserver/glassfish/domains/domain1/appagent |     1404919772769 |              1409266458427 |
|          2 | 10 |      27 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1405095827322 |              1409166636142 |
|          2 | 33 |       3 | MACHINE_AGENT | Machine Agent v3.7.11.1 GA Build Date 2013-10-23 17:09:15                                             |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics/machineagent                                                    |     1407528152300 |              1409069868629 |
|          2 | 34 |       1 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528167695 |              1407528167695 |
|          2 | 35 |       1 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528168470 |              1407528168470 |
|          2 | 36 |       5 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528177271 |              1409071050583 |
|          2 | 37 |       7 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528181676 |              1409090867355 |
|          2 | 38 |       7 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528181876 |              1409090866984 |
|          2 | 39 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528195517 |              1409166636132 |
|          2 | 40 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528195547 |              1409166636130 |
|          2 | 41 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528195579 |              1409166636139 |
|          2 | 42 |       5 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1407528202159 |              1409071050653 |
|          2 | 43 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528205710 |              1409166636165 |
|          2 | 44 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528206335 |              1409166636139 |
|          2 | 45 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528206764 |              1409166636149 |
|          2 | 46 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528207217 |              1409166636139 |
|          2 | 47 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528209016 |              1409166636146 |
|          2 | 48 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528273858 |              1409166636130 |
|          2 | 49 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528273998 |              1409166636129 |
|          2 | 50 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274052 |              1409166636130 |
|          2 | 51 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274056 |              1409166636216 |
|          2 | 52 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274124 |              1409166636135 |
|          2 | 53 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274173 |              1409166636146 |
|          2 | 54 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274206 |              1409166636146 |
|          2 | 55 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274229 |              1409166636144 |
|          2 | 56 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274341 |              1409166636133 |
|          2 | 57 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274359 |              1409166636142 |
|          2 | 58 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274487 |              1409166636146 |
|          2 | 59 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274626 |              1409166636129 |
|          2 | 60 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274726 |              1409166636142 |
|          2 | 61 |       5 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1407528274743 |              1409166636129 |
|          2 | 62 |       2 | MACHINE_AGENT | Machine Agent v3.7.11.1 GA Build Date 2013-10-23 17:09:15                                             |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics/machineagent                                                    |     1408557693239 |              1408631086884 |
|          2 | 64 |       3 | APP_AGENT     | Server Agent v3.8.1.0 GA #2014-04-29_16-18-31 rff34c53c5ceba25909ace785af6d1da418459839 16-3.8.1.next |             3 |             8 |             1 |                   0 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_25    | /apps/lriservers/appDynamics/appAgent                                                |     1408559969723 |              1409166636132 |
|          2 | 65 |       3 | MACHINE_AGENT | Machine Agent v3.7.11.1 GA Build Date 2013-10-23 17:09:15                                             |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics/machineagent                                                    |     1408569958705 |              1408664898601 |
|          2 | 66 |       2 | MACHINE_AGENT | Machine Agent v3.7.11.1 GA Build Date 2013-10-23 17:09:15                                             |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics/machineagent                                                    |     1408569963799 |              1408663880342 |
|          2 | 67 |       3 | MACHINE_AGENT | Machine Agent v3.7.11.1 GA Build Date 2013-10-23 17:09:15                                             |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Oracle Corporation|java.version=1.7.0_45    | /apps/lriappdynamics/machineagent                                                    |     1408570080796 |              1408571468597 |
|          2 | 68 |      37 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408631075303 |              1409143422281 |
|          2 | 69 |      37 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408631075531 |              1409143422396 |
|          2 | 70 |       3 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408646486271 |              1408719676909 |
|          2 | 71 |       3 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408646486332 |              1408719677078 |
|          2 | 72 |       3 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408646522988 |              1408719817177 |
|          2 | 73 |       3 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408646523261 |              1408719817048 |
|          2 | 74 |       9 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408660053617 |              1409332573283 |
|          2 | 75 |       9 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408663865492 |              1409332579010 |
|          2 | 76 |       9 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408663865599 |              1409332579093 |
|          2 | 77 |       7 | APP_AGENT     | Server Agent v3.7.11.1 GA #2013-10-23_17-07-44 r41149afdb8ce39025051c25382b1cf77e2a7fed0 21           |             3 |             7 |            11 |                   1 | java.vm.name=Java HotSpot(TM) 64-Bit Server VM|java.vendor=Sun Microsystems Inc.|java.version=1.6.0_30 | /apps/lriappdynamics                                                                 |     1408664853863 |              1409332572879 |
+------------+----+---------+---------------+-------------------------------------------------------------------------------------------------------+---------------+---------------+---------------+---------------------+--------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------+-------------------+----------------------------+
46 rows in set (0.01 sec)

mysql>
mysql> select count(*) from agent;
+----------+
| count(*) |
+----------+
|       46 |
+----------+
1 row in set (0.00 sec)

mysql>

